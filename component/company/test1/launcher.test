package require tcltest
namespace import ::tcltest::*

workingDirectory $env(HOME)/tclfbp/component/company/test1 

test tc-1.1 {test cloner} -setup {

} -body {

set cmd "exec tclsh $env(HOME)/tclfbp/component/company/test1/agent.tcl &"
eval $cmd
after 100

set sd [socket localhost 14000]

puts $sd "graph1 CREATE"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 INIT"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 IDENT"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 ENABLE"
flush $sd
gets $sd rc
#puts "rc = $rc"

# Expect TESTEND
gets $sd result 
#puts "rc = $rc"

puts $sd "graph1 DISABLE"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 SHUTDOWN"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 CLEANUP"
flush $sd
gets $sd rc
#puts "rc = $rc"

puts $sd "graph1 IDENT_AGENT"
flush $sd
gets $sd rc
#puts "rc = $rc"

set process_id [lindex $rc 1]
exec kill -9 $process_id

set result

} -cleanup {

} -result {TESTEND}

cleanupTests

